<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stageflow Test App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>Stageflow Test App</h1>
            <div class="header-actions">
                <div class="pipeline-selector">
                    <label for="pipeline-select">Pipeline:</label>
                    <select id="pipeline-select">
                        {% for pid, pconfig in pipelines.items() %}
                        <option value="{{ pid }}" title="{{ pconfig.description }}">{{ pconfig.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button class="btn-help" id="help-btn" title="Pipeline help">?</button>
                <button class="btn-clear" id="clear-all">Clear All</button>
            </div>
        </header>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Left panel: DAG + Observability -->
            <div class="left-panel">
                <!-- Toggle Panel -->
                <div class="toggle-panel panel" id="toggle-panel">
                    <div class="panel-header">
                        <span class="panel-title">Toggle Panel</span>
                    </div>
                    <div class="panel-content">
                        <div class="toggle-container">
                            <div class="toggle-switch" id="toggle-switch">
                                <div class="toggle-slider"></div>
                            </div>
                            <div class="toggle-status" id="toggle-status">OFF</div>
                        </div>
                        <div class="toggle-message" id="toggle-message">Agent can toggle this panel</div>
                    </div>
                </div>

                <!-- Resizer -->
                <div class="resizer resizer-horizontal" id="resizer-toggle-dag"></div>

                <!-- DAG Visualization -->
                <div class="dag-panel panel" id="dag-panel">
                    <div class="panel-header">
                        <span class="panel-title">Pipeline DAG</span>
                        <span class="panel-status" id="dag-status"></span>
                    </div>
                    <div class="panel-content">
                        <div class="dag-container" id="dag-container">
                            <svg id="dag-svg"></svg>
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div class="resizer resizer-horizontal" id="resizer-dag-outputs"></div>

                <!-- Pipeline Outputs -->
                <div class="outputs-panel panel" id="outputs-panel">
                    <div class="panel-header">
                        <span class="panel-title">Stage Outputs</span>
                        <button class="btn-clear" id="clear-outputs">Clear</button>
                    </div>
                    <div class="panel-content">
                        <div class="outputs-container" id="outputs-container">
                            <div class="outputs-empty">Run a pipeline to see outputs</div>
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div class="resizer resizer-horizontal" id="resizer-outputs-obs"></div>

                <!-- Observability Panel -->
                <div class="observability-panel panel" id="observability-panel">
                    <div class="panel-header">
                        <span class="panel-title">Observability</span>
                        <button class="btn-clear" id="clear-logs">Clear</button>
                    </div>
                    <div class="panel-content">
                        <div class="logs-container" id="logs-container"></div>
                    </div>
                </div>
            </div>

            <!-- Resizer -->
            <div class="resizer resizer-vertical" id="resizer-main"></div>

            <!-- Right panel: Chat -->
            <div class="chat-panel panel" id="chat-panel">
                <div class="panel-header">
                    <span class="panel-title">Chat</span>
                    <button class="btn-clear" id="clear-chat">Clear</button>
                </div>
                <div class="panel-content">
                    <div class="messages-container" id="messages-container"></div>
                    <div class="chat-input-container">
                        <textarea 
                            id="chat-input" 
                            placeholder="Type your message..."
                            rows="2"
                        ></textarea>
                        <button id="send-btn" class="btn-send">
                            <span class="btn-text">Send</span>
                            <span class="btn-loading" style="display: none;">...</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pipeline Help Modal -->
    <div class="modal hidden" id="pipeline-modal">
        <div class="modal-backdrop" id="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Pipeline Help</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modal-description"></p>
                <div class="modal-section" id="modal-instructions">
                    <h3>How to use</h3>
                    <p id="modal-instructions-text"></p>
                </div>
            </div>
        </div>
    </div>

    <script id="pipeline-data" type="application/json">
        {{ pipeline_meta | tojson | safe }}
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
