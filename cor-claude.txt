pipeline: dispatch/router, chooses between agent path and worker path. agent has two tool sit can execute, to move toggles in the ui. the worker emits something that is viewable in the ui. reversing the input word. i want guardrails. a persist stage (mocked), 
The Groq client wrapper currently just returns response.choices[0].message.content and discards the rest of the completion payload (which is where usage.prompt_tokens and usage.completion_tokens live). When a pipeline stage serializes its result, it only has the text plus whatever fields were already captured (model, input_tokens, etc.), so only input tokens appear. To surface output tokens youâ€™d need to keep the full response from groq.chat.completions.create(), read the usage.completion_tokens (or usage.output_tokens on newer models) field, and include it when building the stage output/UI payload.
this raises the question of the metadata sent from any provider. do we account for it in stageflow?
what does a router do? it picks pipelines. so router will be outside the pipeline. will it be its own pipeline? what si the best way of doing this? it coudl spawn subpipelines?
how do we deal with diffs and undos?